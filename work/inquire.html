<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="/style.css">
    <title>Inquire - Glenn's Notepad</title>
    <meta charset="UTF-8">
    <meta name="author" content="Glenn Bitar">
</head>

<body>
    <header>
        <h1>Glenn's Notepad</h1>
    </header>
    <nav>
        <a href="../index.html">Home</a>
    </nav>
    <main>
        <article>
            <h2>Inquire</h2>
            <section>
                <h3>TLDR</h3>
                <p>
                    I led the design and development of <em>Inquire</em>, a centralized user data service powering
                    personalization across more than 100 local newspapers.
                </p>
                <ul>
                    <li>
                        Adopted an entity-attribute-value (EAV) data model for flexibility and rapid onboarding of new
                        user attributes.
                    </li>
                    <li>
                        Built an attribute catalog and intuitive management panel to enable high degree of self-service
                        and reduce platform bottlenecks.
                    </li>
                    <li>
                        Integrated monitoring to provide data owners with high-resolution insights into usage patterns.
                    </li>
                    <li>
                        Incorporated user consent data, ensuring compliant and confident data access for consumers.
                    </li>
                    <li>
                        Implemented in-flight type checking to guarantee the correctness of delivered data.
                    </li>
                </ul>
            </section>
            <section>
                <h3>Background</h3>
                <p>
                    At <a href="https://www.amedia.no/">Amedia</a>, we host and develop for more than 100 local
                    newspaper across Norway.
                    A portion of Amedia's success is owed to partially personalized front pages, along with personalized
                    marketing and communications.
                    Amedia's backend is a collection of (micro) services called in a variety of situations, e.g., to
                    serve the contents of an article, a front-page teaser, or marketing messages.
                </p>
                <p>
                    Since each page load is partially tailored to the logged in user, many of the backend services
                    require attributes of the user in order to function optimally.
                    Much of this data lives in our data lake, which is not optimized for fast, single-row acces (i.e.,
                    data for a single user).
                </p>
                <p>
                    To support in-flight requests for user analytics, Amedia has over the course of several years
                    developed multiple services that host selections of user attributes for fast access.
                    <em>Inquire</em> is the third iteration of a user data service, and was made to address some
                    challenges that were revealed along the way:
                </p>
                <dl>
                    <dt>Need for high-resolution usage metrics</dt>
                    <dd>
                        Not having usage metrics on the attribute level left us searching in our codebases for whether
                        or not an attribute was used if we wanted to retire it.
                        Combined with each request returning <em>all</em> user data, it made attribute usage information
                        hard to find.
                    </dd>

                    <dt>Out-of-band consent data</dt>
                    <dd>
                        Whether the user consented to use of attributes for personalized ads, communications, marketing
                        or editorial content had to be requested from separate services.
                        This caused unnecessary complexity for data consumers.
                    </dd>

                    <dt>Platform bottleneck</dt>
                    <dd>
                        Appending user attributes required significant work for the maintaining platform team.
                        One column per user attribute implied schema migrations and accompanying application code
                        changes whenever, e.g., a marketing team wanted to test new personalized messages.
                        The fast pace of these teams are important for the organization.
                    </dd>
                </dl>
                <p>
                    While the previous iterations of the user data services have provided tremendous value for Amedia,
                    Inquire was built to confront the challenges listed above.
                </p>
            </section>

            <section>
                <h3>System overview</h3>
                <p>
                    Inquire consists of a central <strong>Postgres database</strong>, an <strong>HTTP/JSON
                        service</strong> that serves user data to downstream consumers, and a suite of support
                    components:
                </p>
                <dl>
                    <dt>Batch ingestion pipeline</dt>
                    <dd>for periodic loading from the data lake.</dd>

                    <dt>Stream ingestion pipeline</dt>
                    <dd>for real-time updates (e.g., user consent).</dd>

                    <dt>Management dashboard</dt>
                    <dd>for attribute onboarding and observability.</dd>
                </dl>
                <p>
                    Inquire is a system composed of a central database containing the user data and attribute catalogs,
                    a HTTP/JSON service that serves this data to logged-in clients and other backend services,
                    and multiple support components, including a management dashboard and pipelines for batch and stream
                    ingestion.
                </p>
                <p>
                    Almost all user analytics data lives in Google BigQuery, and is updated at most daily.
                    The batch ingest pipeline regularly checks source tables for updates and makes sure that the latest
                    data is imported to the Inquire database.
                    Other data, user consents, are retrieved from message queues via the stream ingestor, immediately
                    following changes to the user's preferences.
                </p>
                <p>
                    The database schema is based on the <a
                        href="https://en.wikipedia.org/wiki/Entity%E2%80%93attribute%E2%80%93value_model">entity-attribute-value</a>
                    (EAV) model, where the main database table has one row per user per attribute, and a single data
                    value column.
                    The value column is <code>jsonb</code> (this is a Postgres database), allowing for a variety of
                    stored data types.
                </p>
            </section>
            <section>
                <h3>Key challenges</h3>
                A selection of key challenges and areas where I had important contributions.
                <section>
                    <h4>Navigating our internal development platform</h4>
                    <p>
                        Amedia is my first job focused mainly on web development.
                        Having a background from research and robotics, I had very little in-depth experience with
                        topics like HTTP, REST (whatever that means), databases, and caching.
                        Amedia is an organization where it's possible to move fast and spin up new backends to solve
                        narrow problems on a whim.
                        This also means that cohesion and uniformity is not the main priority.
                        The GitHub organization has close to a thousand repositories in <span
                            title="In my very short investigation, I found the following languages: Python, Rust, Go, Kotlin, Java, Javascript, Clojure, Swift, Typescript, Dart, Scala, Php, Ruby.">than
                            13 languages(!)</span>.
                    </p>
                    <p>
                        As the sole developer on our data platform team with the time and motivation for developing API
                        services, moving from task to deployment was a challenge.
                        Especially since most of the consepts were new to me.
                        When I started this work, much of the knowledge needed to deploy a service was distributed among
                        the many teams, and a uniform guide or a "golden path" did not exist.
                        For a while I was the annoying guy constantly asking questions to our IDP team to get from start
                        to finish.
                    </p>
                </section>
                <section>
                    <h4>Flexible data modeling with EAV</h4>
                    <p>
                        A key design choice in Inquire is an entity-attribute-value data model.
                        This removes the need for schema migrations or application changes changes when a new attribute
                        is added.
                        Each row contains a user ID, an attribute ID which references an attribute catalog, a bit of
                        metadata, and the data value itself, stored as JSON.
                        The attribute catalog contains a human-readable name and expected type information.
                    </p>
                </section>
                <section>
                    <h4>Management dashboard</h4>
                </section>
            </section>
        </article>
    </main>
</body>

</html>